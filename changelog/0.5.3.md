# Nexus 0.5.3 - September 24, 2025

## Summary
This patch release focuses on improving observability and telemetry, fixing a critical issue with Anthropic Claude's tool result handling, and enhancing the startup logging experience. The release also includes a dependency update for the MCP client library.

## Bug Fixes

### Fixed Duplicate Tool Results in Anthropic Claude Responses
**Issue:** When using Claude models through the Anthropic provider, tool call results followed by text content were being duplicated in the response stream, causing confusing output for users.

**Resolution:** Improved the message conversion logic in the Anthropic provider to correctly handle mixed tool results and text content without duplication.

**Technical Details:**
- Modified the unified-to-Anthropic message conversion in `crates/llm/src/messages/unified/to_anthropic.rs`
- Updated input processing in `crates/llm/src/provider/anthropic/input.rs`

### Fixed Telemetry Child Span Sampling Issue
**Issue:** Child spans were being sent to the telemetry collector even when their parent span was not sampled, causing unnecessary overhead and confusing trace data.

**Resolution:** Implemented proper span sampling inheritance to ensure child spans respect parent sampling decisions.

**Technical Details:**
- Enhanced tracing logic in multiple components to check parent span sampling status
- Added new utility function in `crates/telemetry/src/tracing.rs` for consistent sampling behavior
- Updated tracing implementations across LLM, MCP, and rate-limit crates

### Restored Nexus Version Logging at Startup
**Issue:** The Nexus version was not being logged at startup, making it difficult to identify which version was running in production environments.

**Resolution:** Moved version logging to immediately after logger initialization in the server crate, ensuring it's the first informational message users see.

**Technical Details:**
- Moved version logging from `nexus/src/main.rs` to `crates/server/src/lib.rs`
- Added `version` field to `ServeConfig` struct for proper version passing
- Updated integration tests to handle the new version parameter
- Ensures consistent version logging across all deployment scenarios

## Dependency Updates

### Updated RMCP Client Library
**Change:** Updated the `rmcp` crate from version 0.6.x to 0.7.0

**Impact:** This update brings improvements to the MCP (Model Context Protocol) client implementation, potentially including bug fixes and performance enhancements for downstream MCP server connections.

## Deployment Notes

This is a patch release with no breaking changes. The update can be deployed directly without any configuration changes or migration steps.
