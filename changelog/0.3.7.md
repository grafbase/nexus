# Nexus 0.3.7 - September 3, 2025

## Summary

This patch release fixes a critical issue with Google's Gemini API streaming responses that prevented proper time-to-first-token (TTFT) metrics collection. The fix ensures that streaming responses with empty initial text chunks are correctly processed, allowing accurate performance monitoring for Google LLM interactions.

## Bug Fixes

### Fixed Google Gemini Streaming Time-to-First-Token Metrics

**Issue:** Google's Gemini API streaming responses were not triggering time-to-first-token (TTFT) metrics when the initial chunks contained empty text strings. This occurred because the code was filtering out empty text content, preventing the metrics system from recognizing the first token arrival.

**Resolution:** Modified the streaming response handler to include all text content from Google's API, including empty strings. This ensures that the first chunk is always detected, enabling accurate TTFT measurements for performance monitoring.

**Technical Details:**
- **Root Cause:** The condition `if let Some(text) = &part.text && !text.is_empty()` was preventing empty text strings from being processed
- **Fix:** Simplified to `if let Some(text) = &part.text` to process all text content regardless of emptiness
- **Files Modified:** 
  - `crates/llm/src/provider/google/output.rs` - Removed empty string filtering in streaming chunk handler
- **Performance Impact:** None - the change only affects metric collection timing, not the actual response processing
- **Metrics Affected:** `gen_ai.client.time_to_first_token` for Google provider streams

## Deployment Notes

This is a minor bug fix release with no breaking changes or special deployment considerations. The fix ensures more accurate performance metrics for Google Gemini streaming responses.

### Verification Steps
1. Monitor `gen_ai.client.time_to_first_token` metrics for Google provider after deployment
2. Verify that TTFT metrics are now consistently recorded for all Google streaming responses
3. Confirm that streaming responses continue to work correctly with both empty and non-empty initial chunks

## Metrics

- **Performance Impact:** None - only affects metric collection accuracy
- **Compatibility:** Fully backward compatible
- **Observability Improvement:** Restores accurate TTFT metrics for Google Gemini streaming responses