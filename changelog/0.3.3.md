# Nexus 0.3.3 - August 21, 2025

## Summary
This release introduces tool calling support across all major LLM providers (Anthropic, OpenAI, Google, and AWS Bedrock), enabling AI models to interact with external systems through function calling. Additionally, we've added Helm chart support for Kubernetes deployments and made significant improvements to the Bedrock provider architecture. This update also includes important dependency updates and minor logging improvements.

## New Features

### Universal Tool Calling Support for LLM Providers
**User Impact:** All major LLM providers now support tool calling (function calling), allowing AI models to interact with external systems, APIs, and services. This enables building sophisticated AI agents that can execute actions, retrieve information, and integrate with third-party services.

**Technical Details:**
- Implemented tool calling support for four providers:
  - **Anthropic**: Full tool calling with Claude models including response caching
  - **OpenAI**: Function calling with GPT models and structured outputs
  - **Google**: Function calling with Gemini models
  - **AWS Bedrock**: Tool calling for all Bedrock models that support it
- Support for streaming tool responses with proper SSE formatting

**Example Usage:**
```json
{
  "messages": [
    {
      "role": "user",
      "content": "What's the weather in San Francisco?"
    }
  ],
  "tools": [
    {
      "type": "function",
      "function": {
        "name": "get_weather",
        "description": "Get current weather for a location",
        "parameters": {
          "type": "object",
          "properties": {
            "location": { "type": "string" }
          }
        }
      }
    }
  ]
}
```

### Kubernetes Helm Chart Support
**User Impact:** Nexus can now be easily deployed to Kubernetes clusters using Helm, with production-ready configurations for scaling, monitoring, and ingress.

**Technical Details:**
- Complete Helm chart with configurable values
- Support for horizontal pod autoscaling (HPA)
- Pod disruption budgets for high availability
- Ingress configuration with TLS support
- ConfigMap and Secret management for configuration
- Service account and RBAC support
- Files added:
  - `helm/Chart.yaml` - Chart metadata and version
  - `helm/values.yaml` - Default configuration values
  - `helm/templates/` - Kubernetes resource templates
  - `helm/README.md` - Deployment documentation
- Configurable replica count and resource limits
- Volume mount support for configuration files
- Health check and readiness probe configuration

**Deployment Example:**
```bash
helm install nexus ./helm \
  --set replicaCount=3 \
  --set ingress.enabled=true \
  --set ingress.hosts[0].host=nexus.example.com
```

## Enhancements/Improvements

### Simplified Bedrock Provider Architecture
**User Impact:** Improved maintainability and reduced complexity in the AWS Bedrock provider implementation.

**Technical Details:**
- Refactored Bedrock provider from 5,000+ lines across multiple files to ~800 lines
- Consolidated model family handling into unified input/output modules
- Removed redundant model-specific implementations
- Simplified to two main modules:
  - `crates/llm/src/provider/bedrock/input.rs` - Unified request transformation
  - `crates/llm/src/provider/bedrock/output.rs` - Unified response parsing
- Maintained full compatibility with all Bedrock model families
- Reduced code duplication by 85%
- Performance impact: Faster compilation times and reduced binary size

## Infrastructure Updates

### Dependency Updates
- **tantivy**: Updated to v0.25.0 - Improved search index performance
- **aws-sdk-bedrockruntime**: Updated to v1.103.0 - Latest AWS SDK features
- **sonic-rs**: Updated to v0.5.4 - Faster JSON parsing
- **taiki-e/install-action**: Updated to v2.58.18 - CI/CD improvements

### Documentation Updates
- Updated README.md with comprehensive tool calling examples
- Added Helm deployment documentation
- Enhanced integration test documentation with tool calling patterns

## Deployment Notes

### New Configuration Options
- **Tool Calling**: All LLM providers now accept `tools` parameter in requests
- **Helm Values**: New Kubernetes deployment configuration via `helm/values.yaml`

### Breaking Changes
- None - Full backward compatibility maintained

### Migration Steps
To enable tool calling in existing deployments:
1. No configuration changes required - tool support is automatic
2. Update client applications to include `tools` parameter in requests
3. Handle tool response messages in streaming or non-streaming mode

For Kubernetes deployments:
1. Review and customize `helm/values.yaml` for your environment
2. Deploy using: `helm install nexus ./helm -f your-values.yaml`
3. Configure ingress and TLS as needed

### Important Notes
- **Tool Calling Compatibility**: Not all models support tool calling - check provider documentation for Bedrock models
- **Streaming**: Tool responses are properly formatted in SSE streams
- **Rate Limiting**: Tool tokens are counted toward rate limits
